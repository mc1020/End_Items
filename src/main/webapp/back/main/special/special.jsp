<%@page isELIgnored="false" pageEncoding="UTF-8" contentType="text/html; utf-8" %><%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%><c:set scope="request" var="base_path" value="${pageContext.request.contextPath}"/><script>    $(function(){        $('#specialDg').treegrid({            url:'${base_path}/special/queryByPageAndRows',            idField:'id',            onLoadSuccess:btn,            treeField:'name',            cascadeCheck:true,            toolbar: '#specialTb',            singleSelect:true,            animate:true,            fit:true,            fitColumns:true,            pagination:true,            lines:true,            columns:[[                {field:'xxx',title:'xxx',width:100,checkbox:true},                {field:'name',title:'名字',width:60,align:'left'},                {field:'path',title:'下载路径',width:80},                {field:'size',title:'章节大小',width:80},                {field:'duration',title:'章节时长',width:80},                {                    field: 'options', title: 'options', width: 120, formatter: function (value, row, index) {                        if(row.special_id!=null) {                            return "<a class='delSection' onclick=\"delSection('"+row.id+"')\">删除</a>";                        }else {                            return "<a class='delSpecial' onclick=\"delSpecial('"+row.id+"')\">删除</a>";                        }                    },                }            ]],        });    });    /*查看专辑的详情*/    function particulars(){        var obj = $("#specialDg").datagrid('getSelections');        if(obj.length==0){            alert("请先选择专辑！！！");        }else{            var id;            for(var i=0;i<obj.length;i++){                if(obj[i].special_id==null){                    id = obj[i].id;                }else {                    id = obj[i].special_id;                }            }            $("#particular").dialog({                width:600,                height:400,                iconCls:'icon-television',                title:'专辑详情',                href:'${base_path}/back/main/special/special_context.jsp?id='+id,                buttons:[{                    text:'关闭',                    iconCls:'icon-cancel',                    handler:function(){                        $("#particular").dialog('close');                    }                }],            });        }    }    /*添加专辑*/    function addSpecial(){        $("#addSpecial").dialog({           width:600,           height:400,           iconCls:'icon-flag_dm',           title:'添加专辑',            href:'${base_path}/back/main/special/add_special.jsp',            buttons:[{                text:'保存',                iconCls:'icon-save',                handler:function(){                    $("#addSpecialForm").form('submit',{                        url:'${base_path}/special/insert',                        success:function(result){                            var resultObj = $.parseJSON(result);                            if(resultObj.success){                                $.messager.show({                                    title:'我的消息',                                    msg:'添加专辑成功!!!',                                    timeout:5000,                                    showType:'slide'                                });                            }else{                                $.messager.show({                                    title:'我的消息',                                    msg:resultObj.message,                                    timeout:5000,                                    showType:'slide'                                });                            }                            $("#addSpecial").dialog('close');                            $("#specialDg").treegrid('reload');                        }                    });                }            },{                text:'关闭',                iconCls:'icon-cancel',                handler:function(){                    $("#addSpecial").dialog('close');                    $("#specialDg").treegrid('reload');                }            }],        });    }    /*操作按钮*/    function btn(){        $(".delSpecial").linkbutton({            iconCls:'icon-delete',            plain:true,        });        $(".delSection").linkbutton({            iconCls:'icon-remove',            plain:true,        });    }    /*删除章节*/    function delSection(id){        $.post("${base_path}/section/delSection",{id:id},function(result){            if(result.success){                $.messager.show({                    title:'我的消息',                    msg:'章节删除成功!!!',                    timeout:5000,                    showType:'slide'                });            }else{                $.messager.show({                    title:'我的消息',                    msg:result.message,                    timeout:5000,                    showType:'slide'                });            }            $("#specialDg").treegrid('reload');        });    }    /*删除专辑*/    function delSpecial(id){        $.post("${base_path}/special/delSpecial",{id:id},function(result){            if(result.success){                $.messager.show({                    title:'我的消息',                    msg:'专辑删除成功!!!',                    timeout:5000,                    showType:'slide'                });            }else{                $.messager.show({                    title:'我的消息',                    msg:result.message,                    timeout:5000,                    showType:'slide'                });            }            $("#specialDg").treegrid('reload');        });    }    /*添加章节*/    function addSection(){        var obj = $("#specialDg").datagrid('getSelections');        if(obj.length==0){            alert("请先选择专辑！！！");        }else {            var id;                if (obj[0].special_id == null) {                    id = obj[0].id;                } else {                    id = obj[0].special_id;                }            $("#addSection").dialog({                width:400,                height:250,                title:'添加章节',                iconCls:'icon-20130406125647919_easyicon_net_16',                href:'${base_path}/back/main/section/add_section.jsp?id='+id,                buttons:[{                    text:'保存',                    iconCls:'icon-save',                    handler:function(){                        $("#addSpecialForm").form('submit',{                            url:'${base_path}/section/insert',                            success:function(result){                                var resultObj = $.parseJSON(result);                                if(resultObj.success){                                    $.messager.show({                                        title:'我的消息',                                        msg:'章节添加成功!!!',                                        timeout:5000,                                        showType:'slide'                                    });                                }else{                                    $.messager.show({                                        title:'我的消息',                                        msg:resultObj.message,                                        timeout:5000,                                        showType:'slide'                                    });                                }                                $("#addSection").dialog('close');                                $("#specialDg").treegrid('reload');                            }                        });                    }                },{                    text:'关闭',                    iconCls:'icon-cancel',                    handler:function(){                        $("#addSection").dialog('close');                        $("#specialDg").treegrid('reload');                    }                }],            });        }    }    /*下载音频*/    function downloadSection(){        var obj = $("#specialDg").datagrid('getSelections');        var fileName=null;        if(obj.length==0){            alert("请先选择你要下载的音频!!!");        }else{            if(obj[0].special_id==null){                alert("请先选择你要下载的音频!!!");            }else{                fileName=obj[0].path;                location.href='${base_path}/section/download?fileName='+fileName+"&style="+"attachment";            }        }    }</script><%--工具栏--%><div id="specialTb">    <a href="#" class="easyui-linkbutton" onclick="particulars()" data-options="text:'专辑详情',iconCls:'icon-zoom_in',plain:true"></a>    <a href="#" class="easyui-linkbutton" onclick="addSpecial()" data-options="text:'添加专辑',iconCls:'icon-save',plain:true"></a>    <a href="#" class="easyui-linkbutton" onclick="addSection()" data-options="text:'添加章节',iconCls:'icon-save',plain:true"></a>    <a href="#" class="easyui-linkbutton" onclick="downloadSection()" data-options="text:'下载音频',iconCls:'icon-arrow_down',plain:true"></a></div><table id="specialDg" style="width:600px;height:400px"></table><div id="particular"></div><div id="addSpecial"></div><div id="addSection"></div>